<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é‡‘é©¬è¿æ˜¥ â€¢ ä¸“å±ç›¸å†Œ</title>
    
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background-color: #050505; 
            font-family: 'Microsoft YaHei', sans-serif; 
            touch-action: none; -webkit-user-select: none; user-select: none;
        }
        /* ğŸ”´ ä¿®å¤å˜å½¢ï¼šå¼ºåˆ¶ block æ¶ˆé™¤åº•éƒ¨é—´éš™ï¼Œå½»åº•é”å®šæ¯”ä¾‹ */
        canvas { display: block; outline: none; }
        
        #canvas-container { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        
        #loading-screen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: #0a0a0a; z-index: 999; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; color: #ffd700; transition: opacity 1s; 
        }
        .spinner { 
            width: 50px; height: 50px; border: 3px solid rgba(255,215,0,0.3); 
            border-radius: 50%; border-top-color: #ffd700; 
            animation: spin 1s ease-in-out infinite; margin-bottom: 20px; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
        
        #status-pill { 
            position: absolute; top: env(safe-area-inset-top, 20px); left: 50%; transform: translateX(-50%); 
            background: rgba(0,0,0,0.6); border: 1px solid rgba(255,215,0,0.5); 
            padding: 8px 20px; border-radius: 30px; display: flex; align-items: center; gap: 10px; 
            color: #fff; transition: all 0.3s; backdrop-filter: blur(5px); font-size: 14px; white-space: nowrap;
        }
        #status-pill.active { border-color: #ff4400; box-shadow: 0 0 15px rgba(255,68,0,0.4); }
        #detect-indicator { width: 10px; height: 10px; border-radius: 50%; background: #555; transition: background 0.3s; }
        #detect-indicator.detected { background: #00ff00; box-shadow: 0 0 8px #00ff00; }
        
        #gesture-guide { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            color: rgba(255,255,255,0.7); text-align: center; pointer-events: none; 
            transition: opacity 1s; font-size: 1.2rem; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        .btn { 
            pointer-events: auto; background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.2); 
            color: #fff; padding: 10px 15px; border-radius: 20px; cursor: pointer; 
            backdrop-filter: blur(5px); transition: all 0.3s; font-size: 14px;
        }
        .btn:active { transform: scale(0.95); }
        .btn.active { border-color: #ffd700; color: #ffd700; }
        
        #bottom-controls { 
            position: absolute; bottom: env(safe-area-inset-bottom, 30px); left: 0; width: 100%; 
            display: flex; justify-content: center; gap: 15px; pointer-events: none; 
        }
        
        #overlay-dimmer { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0); z-index: 5; pointer-events: none; transition: background 0.5s; 
        }
        #close-btn { 
            position: absolute; top: env(safe-area-inset-top, 30px); right: 20px; 
            background: rgba(255,68,0,0.9); color: white; border: none; padding: 8px 20px; 
            border-radius: 20px; cursor: pointer; opacity: 0; pointer-events: none; 
            transition: opacity 0.3s; z-index: 20; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        #close-btn.visible { opacity: 1; pointer-events: auto; }

        #ai-btn { 
            position: absolute; bottom: env(safe-area-inset-bottom, 30px); right: 20px; 
            background: linear-gradient(45deg, #ff9900, #ff4400); width: 45px; height: 45px; 
            border-radius: 50%; border: none; cursor: pointer; display: flex; justify-content: center; 
            align-items: center; font-size: 22px; box-shadow: 0 4px 15px rgba(255,68,0,0.5); 
            pointer-events: auto; z-index: 20; color: white;
        }
        #ai-chat-modal { 
            position: absolute; bottom: 85px; right: 20px; width: calc(100% - 40px); max-width: 320px; height: 400px; 
            background: rgba(20,20,20,0.95); border: 1px solid #ff4400; border-radius: 15px; 
            display: flex; flex-direction: column; z-index: 20; pointer-events: auto; 
            backdrop-filter: blur(10px); transition: all 0.3s; overflow: hidden; 
        }
        #ai-chat-modal.hidden { opacity: 0; pointer-events: none; transform: translateY(20px) scale(0.95); }
        .chat-header { background: #331100; padding: 12px 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ff4400; }
        .chat-header span { color: #ffd700; font-weight: bold; font-size: 15px;}
        #close-chat-btn { background: none; border: none; color: #fff; font-size: 22px; cursor: pointer; padding: 0 5px;}
        #chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { max-width: 85%; padding: 8px 12px; border-radius: 10px; font-size: 14px; line-height: 1.4; word-wrap: break-word; }
        .user-msg { background: #0055ff; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .ai-msg { background: #333; color: #eee; align-self: flex-start; border-bottom-left-radius: 2px; border: 1px solid #555; }
        .chat-input-area { display: flex; padding: 10px; border-top: 1px solid #444; background: #111; gap: 8px;}
        #chat-input { flex: 1; background: #222; border: 1px solid #555; color: white; padding: 8px 12px; border-radius: 20px; outline: none; font-size: 14px;}
        #send-msg-btn { background: #ff4400; border: none; color: white; padding: 0 15px; border-radius: 20px; cursor: pointer; font-weight: bold; white-space: nowrap;}
    </style>
    
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
      }
    </script>
    <script src="https://unpkg.com/marked@4.3.0/marked.min.js"></script>
</head>
<body>

    <video id="webcam" autoplay playsinline webkit-playsinline muted style="display:none;"></video>

    <div id="loading-screen">
        <div class="spinner"></div>
        <div id="loading-text" style="text-align: center; line-height: 1.6;">
            æ­£åœ¨å”¤é†’ AI è§†è§‰å¼•æ“...<br>
            <span style="font-size: 12px; color: #888;">(é¦–æ¬¡è¿›å…¥è¯·å…è®¸æ‘„åƒå¤´æƒé™)</span>
        </div>
    </div>

    <div id="canvas-container"></div>
    <div id="overlay-dimmer"></div>
    <button id="close-btn">è¿”å› âœ–</button>

    <div id="ui-layer">
        <div id="status-pill">
            <div id="detect-indicator"></div>
            <span id="gesture-icon">âœŠ</span>
            <span id="status-text">è¯·å…è®¸æ‘„åƒå¤´</span>
        </div>
        
        <div id="gesture-guide">
            <div>æ¡æ‹³ âœŠ å‡èšé‡‘é©¬</div>
            <div style="margin-top: 10px;">å¼ æ‰‹ ğŸ–ï¸ ç»½æ”¾ç›¸å†Œ</div>
        </div>

        <div id="bottom-controls">
            <button id="manual-btn" class="btn">æ‰‹åŠ¨æ¨¡å¼</button>
            <button id="audio-btn" class="btn">ğŸ”‡ éŸ³æ•ˆå·²å…³</button>
        </div>
    </div>

    <button id="ai-btn">ğŸ¤–</button>
    
    <div id="ai-chat-modal" class="hidden">
        <div class="chat-header">
            <span>ğŸ® AI æ–°æ˜¥è´ºå²é¡¾é—®</span>
            <button id="close-chat-btn">Ã—</button>
        </div>
        <div id="chat-messages">
            <div class="message ai-msg">æ–°å¹´å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å± AI åŠ©æ‰‹ã€‚ä½ å¯ä»¥é—®æˆ‘å…³äºæœ‹å‹ä»¬çš„è¶£äº‹ï¼Œæˆ–è€…è®©æˆ‘ç»™ä½ å†™ä¸€æ®µé…·ç‚«çš„æ–°å¹´ç¥ç¦ï¼</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" placeholder="è¾“å…¥ä½ æƒ³é—®çš„...">
            <button id="send-msg-btn">å‘é€</button>
        </div>
    </div>

    <script type="module" src="./script.js"></script>
</body>
</html>
